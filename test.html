<!doctype html>
<html>
  <body>
    <script type="module">
      const gpu = navigator.gpu;
      if (!gpu) document.body.textContent = 'WebGPU not supported on this browser';

      const adapter = await gpu.requestAdapter();
      if (!adapter) document.body.textContent = 'No appropriate GPU adapter found';

      const device = await adapter.requestDevice();

      const format = gpu.getPreferredCanvasFormat();

      // prettier-ignore
      const tests = [
        { code: 'sample_bool(uv, true)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,110,73,68,65,84,72,75,237,150,49,14,192,48,8,3,241,255,31,237,14,180,40,9,165,234,108,57,19,2,101,224,176,12,8,63,19,24,8,128,228,90,2,182,12,128,136,32,153,65,197,253,151,9,235,17,216,70,190,142,255,144,66,23,71,101,244,160,184,163,36,240,46,142,162,243,199,57,172,18,85,49,141,206,209,87,201,228,37,170,104,220,215,215,90,201,195,162,204,227,182,154,231,10,57,46,21,163,212,35,112,1,97,189,81,7,37,3,150,148,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_bool(uv, false)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,124,73,68,65,84,72,75,237,150,81,14,192,32,8,67,219,251,31,154,101,33,97,12,113,49,251,35,41,95,138,104,244,41,69,66,38,2,27,2,52,179,60,68,18,64,56,163,235,141,108,121,34,217,175,35,236,163,9,220,151,90,46,62,123,188,253,29,227,231,95,99,70,115,209,230,1,188,50,190,200,134,3,106,31,71,171,46,1,116,149,25,177,158,72,224,167,114,148,250,178,123,64,19,137,104,207,79,146,31,150,149,162,10,229,195,145,133,36,244,70,148,167,19,184,0,177,141,84,7,165,254,139,41,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_u32(uv, 0)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,75,73,68,65,84,72,75,237,150,65,10,0,48,8,195,236,255,31,221,49,58,156,23,127,144,30,4,241,22,130,170,34,16,88,8,168,170,108,103,42,221,150,64,224,249,16,51,162,133,109,252,192,140,38,160,8,49,43,116,32,240,55,71,175,13,46,11,90,76,2,252,28,248,176,18,56,178,126,27,7,62,246,204,28,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_u32(uv, 4294967295)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,165,73,68,65,84,72,75,237,86,65,14,128,48,8,147,255,63,122,102,193,212,10,174,198,37,219,9,79,72,2,204,182,150,217,81,79,33,48,64,192,60,223,90,51,187,98,127,245,60,146,57,51,81,133,38,220,252,115,214,107,85,17,186,1,129,46,8,71,159,117,16,98,150,14,226,95,85,249,75,188,79,238,172,51,27,16,169,17,64,224,162,39,56,71,182,19,254,125,65,234,200,111,92,106,161,132,65,207,227,130,38,238,243,201,62,69,228,82,4,30,20,194,63,130,43,100,94,181,213,143,92,65,172,48,94,106,24,167,53,180,20,151,106,222,197,160,77,34,200,133,183,207,196,157,67,148,136,91,136,112,160,162,112,41,2,39,206,101,174,7,75,18,44,150,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_i32(uv, 0)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,75,73,68,65,84,72,75,237,150,65,10,0,48,8,195,236,255,31,221,49,58,156,23,127,144,30,4,241,22,130,170,34,16,88,8,168,170,108,103,42,221,150,64,224,249,16,51,162,133,109,252,192,140,38,160,8,49,43,116,32,240,55,71,175,13,46,11,90,76,2,252,28,248,176,18,56,178,126,27,7,62,246,204,28,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_i32(uv, 2147483647)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,158,73,68,65,84,72,75,237,86,91,14,128,48,8,131,251,31,26,179,144,32,129,61,80,131,95,221,151,67,233,102,75,10,76,88,96,96,193,0,19,145,136,232,91,230,177,213,37,34,126,27,34,150,18,18,67,86,70,174,68,138,103,65,211,110,6,216,203,105,207,42,97,168,149,16,201,101,20,178,50,242,62,226,1,143,103,117,243,2,252,33,193,202,42,234,66,106,13,233,247,71,231,8,182,228,29,104,131,179,50,51,72,216,202,192,221,86,62,54,145,220,104,158,58,135,149,151,255,97,187,85,110,115,173,188,0,124,56,199,116,122,168,76,33,83,181,142,206,241,98,230,152,14,64,16,239,7,6,46,152,101,177,7,27,200,236,78,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_i32(uv, -2147483647)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,172,73,68,65,84,72,75,237,86,91,14,192,32,8,131,251,31,154,197,144,48,82,240,177,76,191,100,127,171,82,181,20,148,169,190,82,160,163,0,167,184,136,40,206,252,78,16,17,255,75,68,30,177,16,8,132,168,200,188,130,44,174,85,89,222,171,64,98,14,72,185,26,66,83,8,94,1,196,118,102,12,16,21,153,199,136,39,156,174,181,87,151,98,107,130,247,42,30,138,53,214,46,115,139,133,94,226,167,233,232,180,115,104,26,192,79,190,253,164,60,16,85,185,60,161,192,232,90,249,121,137,68,219,125,237,28,102,11,127,114,219,85,106,205,19,26,93,203,153,95,43,49,25,43,175,144,113,35,177,90,143,143,146,41,50,110,99,215,38,239,244,193,31,37,161,180,7,48,43,125,252,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 0)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,75,73,68,65,84,72,75,237,150,65,10,0,48,8,195,236,255,31,221,49,58,156,23,127,144,30,4,241,22,130,170,34,16,88,8,168,170,108,103,42,221,150,64,224,249,16,51,162,133,109,252,192,140,38,160,8,49,43,116,32,240,55,71,175,13,46,11,90,76,2,252,28,248,176,18,56,178,126,27,7,62,246,204,28,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 123.456)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,179,73,68,65,84,72,75,237,86,91,10,192,48,8,155,247,63,116,71,113,184,224,139,176,245,211,125,117,98,85,98,26,149,107,190,65,160,64,64,212,190,214,18,121,206,250,171,118,51,70,75,26,16,227,216,21,12,197,68,78,115,157,170,112,152,192,35,176,9,161,205,64,30,184,179,107,57,210,8,51,53,113,82,10,186,212,154,5,131,88,222,83,21,242,184,140,231,166,68,213,182,40,39,169,197,64,180,214,70,177,49,230,161,150,168,27,222,170,206,100,133,164,182,77,215,121,4,186,177,210,104,73,76,144,14,145,158,58,170,19,198,18,229,16,163,22,140,218,241,16,140,103,133,192,59,86,210,247,29,141,110,53,113,35,166,218,57,154,221,229,195,22,66,110,51,211,245,159,8,220,118,147,216,7,72,110,191,140,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 0.001)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,121,73,68,65,84,72,75,237,86,65,10,192,48,8,51,255,127,116,70,113,200,54,117,244,90,137,135,66,173,150,54,9,42,76,38,4,26,4,96,102,36,253,20,88,219,210,114,76,153,69,242,231,18,177,112,22,2,112,142,157,209,142,218,28,83,102,61,157,103,161,160,215,150,8,44,113,0,175,53,199,229,152,46,75,149,99,146,206,110,89,68,115,41,155,66,80,30,181,33,123,28,20,137,99,148,56,186,153,227,67,243,206,204,177,51,187,76,194,110,252,95,46,176,51,99,7,81,158,26,176,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 100)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,103,73,68,65,84,72,75,237,150,81,10,0,32,8,67,243,254,135,54,98,97,98,214,1,156,125,68,142,126,92,143,165,140,94,237,192,195,1,129,174,170,34,251,140,18,186,137,183,210,150,150,119,96,1,129,135,15,28,160,4,52,254,66,192,168,188,65,204,13,38,201,97,64,0,139,116,103,182,140,167,247,39,28,62,81,44,45,66,198,240,216,196,217,233,249,86,254,19,70,207,28,132,124,76,49,235,69,7,3,176,212,11,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 100.001)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,185,73,68,65,84,72,75,237,150,225,14,128,32,8,132,243,253,31,218,230,104,215,141,19,83,215,250,19,253,202,27,10,226,39,82,142,252,50,3,65,6,138,233,181,214,82,174,127,27,154,14,81,21,93,112,102,214,91,54,46,102,44,171,97,243,190,18,131,165,12,52,32,44,179,142,3,27,26,52,108,224,48,130,51,181,153,84,216,175,249,122,84,186,49,43,4,110,95,75,121,73,227,134,132,86,14,0,129,163,82,165,91,54,6,246,209,154,92,165,0,40,151,1,48,10,143,206,11,226,103,3,70,54,43,199,54,232,33,28,124,59,113,155,7,119,81,109,102,20,142,91,107,82,164,68,143,72,4,250,118,118,126,62,241,126,86,198,29,70,183,231,216,232,84,62,232,57,150,250,164,159,31,255,120,251,39,165,64,255,7,224,252,246,80,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 1.175494351E-38)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,192,73,68,65,84,72,75,237,150,203,18,192,48,4,69,227,255,63,90,23,58,170,87,136,62,118,209,85,199,120,36,28,130,70,127,157,129,32,3,36,114,102,38,58,255,163,92,89,29,102,182,106,68,228,37,83,207,170,102,195,249,232,32,241,86,32,137,162,195,93,150,126,154,147,91,89,133,140,49,70,14,71,162,35,133,156,226,5,86,128,151,68,244,158,151,86,222,207,11,184,225,204,21,15,187,161,243,114,114,104,154,52,167,182,119,181,234,30,26,80,243,96,229,168,1,193,121,116,152,109,254,204,138,230,178,55,118,195,66,238,251,9,142,168,219,180,192,81,121,244,33,171,60,79,149,121,83,233,251,124,222,84,60,236,134,200,53,216,161,123,42,175,62,236,13,154,187,100,159,248,101,231,168,32,53,45,100,239,28,143,248,62,0,200,248,234,7,29,124,9,37,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, 3.402823466E+38)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,165,73,68,65,84,72,75,237,86,73,14,192,32,8,132,255,63,154,166,33,177,132,41,46,68,79,226,73,17,16,25,152,192,84,171,50,16,100,128,137,72,68,244,150,249,61,70,75,68,172,2,90,29,146,52,183,46,200,68,60,85,6,75,25,96,155,98,151,110,235,72,17,106,197,97,143,106,133,126,78,72,92,72,54,30,183,159,252,215,82,178,110,83,254,168,162,95,25,29,248,177,131,93,13,33,39,225,91,29,137,101,14,245,28,113,137,94,13,95,191,13,227,244,127,167,152,3,193,104,24,56,10,113,236,130,157,141,12,180,164,83,204,145,70,58,97,24,206,28,195,230,118,19,198,111,55,111,209,169,153,35,129,235,22,147,7,101,209,237,7,107,118,81,82,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, u32tof32(2143289344u))', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,106,73,68,65,84,72,75,237,150,81,10,192,48,12,66,231,253,15,237,40,1,91,146,110,7,16,251,81,74,205,79,30,98,130,39,39,4,62,8,128,36,128,82,245,38,89,63,37,93,107,130,212,158,192,50,71,51,193,180,194,172,177,231,146,6,151,43,202,10,237,62,209,76,85,73,19,130,222,4,246,88,81,60,92,147,67,243,69,49,227,205,37,221,237,228,56,119,142,31,115,180,253,35,4,189,9,188,72,210,90,7,177,178,173,26,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, u32tof32(4294967294u))', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,113,73,68,65,84,72,75,237,150,193,10,192,48,8,67,151,255,255,232,236,96,9,67,109,217,217,166,135,82,212,75,30,33,21,143,143,9,108,8,160,214,73,2,171,174,55,201,152,140,86,59,99,200,195,8,244,230,72,38,168,86,8,175,84,163,12,163,115,185,28,40,18,20,12,97,133,116,127,49,213,174,146,230,114,154,195,228,159,190,21,197,67,155,28,138,13,69,200,48,52,150,243,107,231,56,152,35,237,31,6,58,137,192,11,244,89,93,7,200,100,66,170,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, u32tof32(2139095040u))', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,99,73,68,65,84,72,75,237,150,65,10,0,32,8,4,221,255,63,218,14,27,139,69,65,231,220,14,81,104,7,135,193,68,120,153,192,133,0,34,34,51,25,5,230,149,7,134,0,40,161,166,25,233,247,4,22,9,36,196,38,10,21,249,158,133,11,220,8,156,229,96,183,168,187,158,217,146,62,14,93,229,208,119,35,69,250,64,113,165,115,126,120,156,57,220,48,26,26,51,0,198,228,63,7,93,92,105,104,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_f32(uv, u32tof32(4286578688u))', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,110,73,68,65,84,72,75,237,150,81,10,192,32,12,67,205,253,15,157,33,197,40,91,133,225,103,141,31,82,74,16,250,8,177,104,62,38,176,33,128,180,79,50,250,64,23,144,140,66,181,4,171,204,144,139,17,200,205,241,53,196,203,40,171,93,138,17,241,56,34,128,93,6,164,105,1,116,125,220,243,137,17,42,198,90,140,192,223,228,208,255,18,17,226,228,40,230,131,116,156,243,157,67,91,200,13,152,238,156,241,1,88,152,66,7,17,143,227,201,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec2_bool(uv, vec2(true, false))', lines: 2, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,12,8,2,0,0,0,68,54,0,125,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,246,73,68,65,84,88,71,237,88,91,14,196,32,8,212,251,31,154,77,131,97,13,35,134,54,141,27,178,211,143,166,181,168,56,76,121,245,198,139,8,4,8,244,214,154,136,232,215,222,175,87,188,76,192,196,230,17,157,37,34,54,93,159,113,22,173,80,11,129,97,66,52,240,146,34,206,252,42,99,84,64,114,68,108,171,133,209,223,106,123,145,67,255,114,187,71,88,56,223,96,98,25,207,65,150,84,100,216,160,133,5,151,141,21,151,129,35,233,75,42,66,67,157,83,57,199,28,62,220,179,38,22,230,60,230,220,133,57,71,117,122,173,51,208,234,167,162,254,175,32,48,200,49,135,140,76,181,130,53,206,114,5,87,212,208,151,188,98,179,99,139,124,195,74,50,219,136,66,12,146,35,51,114,236,156,220,232,1,2,183,61,135,75,47,230,206,7,210,203,117,80,176,59,242,64,99,78,57,134,64,150,28,206,240,251,202,37,234,145,236,131,215,177,51,115,163,36,2,169,106,101,31,32,176,31,138,222,37,242,55,73,45,41,246,19,4,62,20,18,207,13,161,51,129,252,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec2_f32(uv, vec2<f32>(1, 22))', lines: 2, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,12,8,2,0,0,0,68,54,0,125,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,174,73,68,65,84,88,71,237,152,75,14,192,32,8,68,225,254,135,166,49,24,181,49,124,182,194,184,104,210,214,69,231,57,25,160,76,88,32,96,16,96,34,18,17,125,203,60,110,173,37,34,254,6,64,46,70,128,213,25,122,234,206,241,159,219,138,33,128,28,139,192,48,7,243,239,138,228,128,93,102,37,89,105,17,102,3,202,74,55,211,100,123,142,100,95,210,13,95,109,189,94,7,90,91,57,212,133,4,166,57,194,146,113,39,7,178,36,132,251,250,134,93,86,156,49,245,180,206,217,192,170,248,208,88,175,51,106,251,253,217,228,176,124,0,103,20,182,78,214,28,247,44,19,78,55,133,169,53,145,150,154,86,86,123,177,126,164,222,79,154,240,106,37,243,3,240,13,93,13,166,51,99,8,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec2_i32(uv, vec2<i32>(1, 22))', lines: 2, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,12,8,2,0,0,0,68,54,0,125,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,174,73,68,65,84,88,71,237,152,75,14,192,32,8,68,225,254,135,166,49,24,181,49,124,182,194,184,104,210,214,69,231,57,25,160,76,88,32,96,16,96,34,18,17,125,203,60,110,173,37,34,254,6,64,46,70,128,213,25,122,234,206,241,159,219,138,33,128,28,139,192,48,7,243,239,138,228,128,93,102,37,89,105,17,102,3,202,74,55,211,100,123,142,100,95,210,13,95,109,189,94,7,90,91,57,212,133,4,166,57,194,146,113,39,7,178,36,132,251,250,134,93,86,156,49,245,180,206,217,192,170,248,208,88,175,51,106,251,253,217,228,176,124,0,103,20,182,78,214,28,247,44,19,78,55,133,169,53,145,150,154,86,86,123,177,126,164,222,79,154,240,106,37,243,3,240,13,93,13,166,51,99,8,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec2_u32(uv, vec2<u32>(1, 22))', lines: 2, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,12,8,2,0,0,0,68,54,0,125,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,174,73,68,65,84,88,71,237,152,75,14,192,32,8,68,225,254,135,166,49,24,181,49,124,182,194,184,104,210,214,69,231,57,25,160,76,88,32,96,16,96,34,18,17,125,203,60,110,173,37,34,254,6,64,46,70,128,213,25,122,234,206,241,159,219,138,33,128,28,139,192,48,7,243,239,138,228,128,93,102,37,89,105,17,102,3,202,74,55,211,100,123,142,100,95,210,13,95,109,189,94,7,90,91,57,212,133,4,166,57,194,146,113,39,7,178,36,132,251,250,134,93,86,156,49,245,180,206,217,192,170,248,208,88,175,51,106,251,253,217,228,176,124,0,103,20,182,78,214,28,247,44,19,78,55,133,169,53,145,150,154,86,86,123,177,126,164,222,79,154,240,106,37,243,3,240,13,93,13,166,51,99,8,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec3_bool(uv, vec3(true, false, true))', lines: 3, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,18,8,2,0,0,0,125,234,99,150,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,1,81,73,68,65,84,104,67,237,90,91,14,132,32,12,132,251,31,26,99,48,181,105,1,199,23,166,113,252,216,184,110,129,50,29,251,98,115,226,69,4,58,8,228,148,82,41,165,254,154,243,250,213,95,34,32,98,250,73,29,85,74,145,225,245,222,143,162,21,98,33,176,153,208,27,184,73,17,99,254,42,35,84,240,228,232,177,45,22,70,191,213,118,37,71,125,203,229,179,135,133,241,13,34,134,120,14,178,36,34,195,54,90,72,112,25,88,177,25,56,64,95,18,17,26,234,12,229,28,58,124,152,251,154,88,136,243,208,185,11,115,142,232,244,106,103,160,209,119,69,253,31,65,96,35,135,14,25,72,181,226,107,156,230,12,166,168,161,47,121,196,102,211,38,217,195,10,152,109,244,66,140,39,7,242,100,218,62,185,208,5,4,78,123,14,147,94,232,206,135,167,151,233,160,248,238,200,5,141,57,100,26,2,40,57,140,225,199,149,75,175,71,50,14,94,211,246,204,133,64,4,160,106,101,28,32,124,63,212,123,151,158,191,1,181,164,216,39,8,176,90,249,4,246,24,139,162,158,67,239,198,156,155,32,29,210,193,193,77,12,156,126,169,229,222,33,53,135,103,189,188,1,169,86,144,102,252,47,209,14,182,233,61,172,28,102,139,60,91,9,102,219,219,234,66,125,14,220,91,104,201,67,182,221,86,158,19,188,139,192,137,127,93,248,242,213,28,215,13,186,26,204,57,222,53,227,59,179,47,251,180,50,34,175,210,252,72,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec3_f32(uv, vec3<f32>(1, 22, 333))', lines: 3, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,18,8,2,0,0,0,125,234,99,150,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,248,73,68,65,84,104,67,237,89,75,10,197,48,8,140,247,63,180,143,146,144,166,248,252,20,186,81,167,139,66,83,23,153,201,160,142,161,129,7,12,40,12,208,24,131,153,231,95,162,235,83,123,152,217,14,0,201,197,24,160,169,140,121,234,198,241,159,97,197,40,0,28,141,129,75,28,68,143,55,50,7,228,178,42,201,206,22,110,110,64,89,233,38,154,104,207,17,236,75,186,209,87,27,175,213,129,214,70,14,116,46,3,75,28,110,201,144,153,3,185,196,37,55,123,192,93,86,12,155,122,74,231,108,96,39,120,87,88,217,57,106,187,255,104,230,208,116,0,101,20,150,78,84,28,210,203,184,238,166,48,107,77,160,133,220,202,110,47,246,32,85,174,52,225,171,21,76,184,149,86,199,253,14,108,40,115,252,189,127,129,127,121,199,116,194,232,53,56,183,125,71,196,173,200,152,132,108,96,203,15,6,238,178,18,241,29,50,38,178,2,202,147,50,240,217,156,3,153,35,169,2,140,109,175,43,251,29,161,141,194,34,29,6,102,166,197,244,241,3,154,97,174,19,58,173,110,152,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec3_i32(uv, vec3<i32>(1, 22, 333))', lines: 3, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,18,8,2,0,0,0,125,234,99,150,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,248,73,68,65,84,104,67,237,89,75,10,197,48,8,140,247,63,180,143,146,144,166,248,252,20,186,81,167,139,66,83,23,153,201,160,142,161,129,7,12,40,12,208,24,131,153,231,95,162,235,83,123,152,217,14,0,201,197,24,160,169,140,121,234,198,241,159,97,197,40,0,28,141,129,75,28,68,143,55,50,7,228,178,42,201,206,22,110,110,64,89,233,38,154,104,207,17,236,75,186,209,87,27,175,213,129,214,70,14,116,46,3,75,28,110,201,144,153,3,185,196,37,55,123,192,93,86,12,155,122,74,231,108,96,39,120,87,88,217,57,106,187,255,104,230,208,116,0,101,20,150,78,84,28,210,203,184,238,166,48,107,77,160,133,220,202,110,47,246,32,85,174,52,225,171,21,76,184,149,86,199,253,14,108,40,115,252,189,127,129,127,121,199,116,194,232,53,56,183,125,71,196,173,200,152,132,108,96,203,15,6,238,178,18,241,29,50,38,178,2,202,147,50,240,217,156,3,153,35,169,2,140,109,175,43,251,29,161,141,194,34,29,6,102,166,197,244,241,3,154,97,174,19,58,173,110,152,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec3_u32(uv, vec3<u32>(1, 22, 333))', lines: 3, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,18,8,2,0,0,0,125,234,99,150,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,248,73,68,65,84,104,67,237,89,75,10,197,48,8,140,247,63,180,143,146,144,166,248,252,20,186,81,167,139,66,83,23,153,201,160,142,161,129,7,12,40,12,208,24,131,153,231,95,162,235,83,123,152,217,14,0,201,197,24,160,169,140,121,234,198,241,159,97,197,40,0,28,141,129,75,28,68,143,55,50,7,228,178,42,201,206,22,110,110,64,89,233,38,154,104,207,17,236,75,186,209,87,27,175,213,129,214,70,14,116,46,3,75,28,110,201,144,153,3,185,196,37,55,123,192,93,86,12,155,122,74,231,108,96,39,120,87,88,217,57,106,187,255,104,230,208,116,0,101,20,150,78,84,28,210,203,184,238,166,48,107,77,160,133,220,202,110,47,246,32,85,174,52,225,171,21,76,184,149,86,199,253,14,108,40,115,252,189,127,129,127,121,199,116,194,232,53,56,183,125,71,196,173,200,152,132,108,96,203,15,6,238,178,18,241,29,50,38,178,2,202,147,50,240,217,156,3,153,35,169,2,140,109,175,43,251,29,161,141,194,34,29,6,102,166,197,244,241,3,154,97,174,19,58,173,110,152,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec4_bool(uv, vec4(true, false, true, false))', lines: 4, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,24,8,2,0,0,0,220,113,64,240,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,1,153,73,68,65,84,104,67,237,90,217,14,195,32,12,131,255,255,104,166,138,42,69,9,80,247,128,42,195,125,152,186,142,35,56,94,206,198,192,139,8,52,16,136,33,132,148,82,254,53,198,237,171,189,100,128,12,43,159,228,89,41,37,153,158,239,237,44,106,193,23,2,187,10,173,130,171,20,81,234,207,99,132,10,150,28,45,182,249,194,104,89,105,55,114,228,127,185,124,182,176,80,182,65,134,33,150,131,44,241,200,176,157,22,226,92,58,90,172,58,14,208,150,120,132,134,50,67,49,71,233,62,212,125,14,44,196,120,148,177,11,99,14,239,244,170,71,160,222,79,69,249,95,65,96,39,71,233,50,144,108,197,230,56,213,21,84,82,67,91,242,138,206,166,45,114,184,21,48,218,104,185,24,75,14,228,201,180,115,114,163,27,8,92,182,28,42,188,40,43,31,150,94,170,130,98,171,35,55,36,230,148,105,8,160,228,80,138,239,103,46,173,26,73,223,121,77,59,51,55,2,17,128,178,149,190,131,176,245,80,107,93,90,246,6,148,146,195,62,65,128,217,202,39,176,251,216,20,181,28,229,105,84,223,4,169,144,118,26,55,62,112,90,82,202,163,66,170,154,103,173,184,1,201,86,144,98,252,146,104,59,59,244,225,86,78,163,69,246,86,156,233,246,177,184,80,157,3,183,22,229,200,83,182,61,22,158,11,140,69,224,194,91,23,54,125,85,237,186,78,85,131,49,199,88,53,142,89,157,217,202,24,92,255,98,213,155,217,10,123,43,127,161,253,147,67,64,217,10,88,4,235,84,81,109,212,178,2,184,222,207,8,101,43,213,55,70,109,229,131,189,21,239,108,80,242,15,180,28,229,78,172,124,120,228,13,26,115,32,141,55,57,63,123,43,30,169,96,101,254,1,43,182,155,40,60,21,201,199,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec4_f32(uv, vec4<f32>(1, 22, 333, 4444))', lines: 4, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,24,8,2,0,0,0,220,113,64,240,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,1,69,73,68,65,84,104,67,237,89,209,10,196,32,12,179,255,255,209,142,161,56,135,83,35,19,164,109,246,112,112,187,222,102,98,104,155,42,129,23,25,232,48,32,33,132,24,99,250,85,228,254,218,187,98,140,227,0,146,108,140,1,73,202,72,187,62,216,254,58,204,24,5,132,211,99,224,22,135,200,235,147,153,131,114,201,149,164,100,139,105,110,96,89,241,38,26,180,231,0,251,18,111,244,217,198,59,234,64,109,35,39,186,41,3,89,28,211,146,209,102,14,230,146,41,185,218,3,158,178,50,176,169,181,116,234,6,54,129,159,10,75,59,71,110,215,143,102,142,158,14,168,12,195,210,65,197,209,122,153,169,187,49,204,154,19,104,144,91,41,237,69,25,164,182,119,156,240,229,10,38,221,138,171,237,94,3,11,101,142,207,243,23,250,151,53,166,21,70,231,193,249,216,119,32,110,165,141,81,200,6,151,252,98,224,41,43,136,239,104,99,144,59,164,92,41,3,219,230,28,204,28,74,21,48,88,118,62,178,47,17,189,81,24,210,97,112,102,106,76,31,116,43,198,54,116,39,28,212,173,124,142,201,145,134,3,105,101,118,2,226,179,246,49,0,185,149,98,101,235,162,131,204,76,57,69,221,183,83,7,158,4,185,149,222,97,219,170,197,61,128,143,175,252,193,0,148,57,144,241,57,18,243,99,157,252,235,1,6,216,115,28,32,93,203,43,47,84,131,11,40,144,24,69,101,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec4_i32(uv, vec4<i32>(1, 22, 333, 4444))', lines: 4, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,24,8,2,0,0,0,220,113,64,240,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,1,69,73,68,65,84,104,67,237,89,209,10,196,32,12,179,255,255,209,142,161,56,135,83,35,19,164,109,246,112,112,187,222,102,98,104,155,42,129,23,25,232,48,32,33,132,24,99,250,85,228,254,218,187,98,140,227,0,146,108,140,1,73,202,72,187,62,216,254,58,204,24,5,132,211,99,224,22,135,200,235,147,153,131,114,201,149,164,100,139,105,110,96,89,241,38,26,180,231,0,251,18,111,244,217,198,59,234,64,109,35,39,186,41,3,89,28,211,146,209,102,14,230,146,41,185,218,3,158,178,50,176,169,181,116,234,6,54,129,159,10,75,59,71,110,215,143,102,142,158,14,168,12,195,210,65,197,209,122,153,169,187,49,204,154,19,104,144,91,41,237,69,25,164,182,119,156,240,229,10,38,221,138,171,237,94,3,11,101,142,207,243,23,250,151,53,166,21,70,231,193,249,216,119,32,110,165,141,81,200,6,151,252,98,224,41,43,136,239,104,99,144,59,164,92,41,3,219,230,28,204,28,74,21,48,88,118,62,178,47,17,189,81,24,210,97,112,102,106,76,31,116,43,198,54,116,39,28,212,173,124,142,201,145,134,3,105,101,118,2,226,179,246,49,0,185,149,98,101,235,162,131,204,76,57,69,221,183,83,7,158,4,185,149,222,97,219,170,197,61,128,143,175,252,193,0,148,57,144,241,57,18,243,99,157,252,235,1,6,216,115,28,32,93,203,43,47,84,131,11,40,144,24,69,101,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_vec4_u32(uv, vec4<u32>(1, 22, 333, 4444))', lines: 4, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,24,8,2,0,0,0,220,113,64,240,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,1,69,73,68,65,84,104,67,237,89,209,10,196,32,12,179,255,255,209,142,161,56,135,83,35,19,164,109,246,112,112,187,222,102,98,104,155,42,129,23,25,232,48,32,33,132,24,99,250,85,228,254,218,187,98,140,227,0,146,108,140,1,73,202,72,187,62,216,254,58,204,24,5,132,211,99,224,22,135,200,235,147,153,131,114,201,149,164,100,139,105,110,96,89,241,38,26,180,231,0,251,18,111,244,217,198,59,234,64,109,35,39,186,41,3,89,28,211,146,209,102,14,230,146,41,185,218,3,158,178,50,176,169,181,116,234,6,54,129,159,10,75,59,71,110,215,143,102,142,158,14,168,12,195,210,65,197,209,122,153,169,187,49,204,154,19,104,144,91,41,237,69,25,164,182,119,156,240,229,10,38,221,138,171,237,94,3,11,101,142,207,243,23,250,151,53,166,21,70,231,193,249,216,119,32,110,165,141,81,200,6,151,252,98,224,41,43,136,239,104,99,144,59,164,92,41,3,219,230,28,204,28,74,21,48,88,118,62,178,47,17,189,81,24,210,97,112,102,106,76,31,116,43,198,54,116,39,28,212,173,124,142,201,145,134,3,105,101,118,2,226,179,246,49,0,185,149,98,101,235,162,131,204,76,57,69,221,183,83,7,158,4,185,149,222,97,219,170,197,61,128,143,175,252,193,0,148,57,144,241,57,18,243,99,157,252,235,1,6,216,115,28,32,93,203,43,47,84,131,11,40,144,24,69,101,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_ascii_u32(uv, 84)', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,61,73,68,65,84,72,75,237,210,33,14,0,32,0,3,49,246,255,71,15,1,130,144,32,240,157,157,187,52,195,20,120,20,72,219,243,74,162,149,2,171,192,166,208,22,11,38,174,2,112,32,241,44,0,7,28,112,48,240,95,96,2,241,64,15,7,150,218,83,1,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_ascii5_u32(uv, array<u32, 5>(84, 82, 85, 69, 32))', lines: 1, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,6,8,2,0,0,0,229,173,35,27,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,110,73,68,65,84,72,75,237,150,49,14,192,48,8,3,241,255,31,237,14,180,40,9,165,234,108,57,19,2,101,224,176,12,8,63,19,24,8,128,228,90,2,182,12,128,136,32,153,65,197,253,151,9,235,17,216,70,190,142,255,144,66,23,71,101,244,160,184,163,36,240,46,142,162,243,199,57,172,18,85,49,141,206,209,87,201,228,37,170,104,220,215,215,90,201,195,162,204,227,182,154,231,10,57,46,21,163,212,35,112,1,97,189,81,7,37,3,150,148,0,0,0,0,73,69,78,68,174,66,96,130]) },
        { code: 'sample_ascii5_u32(uv - vec2f(1, 1), array<u32, 5>(84, 82, 85, 69, 32))', lines: 3, expected: Uint8Array.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,180,0,0,0,18,8,2,0,0,0,125,234,99,150,0,0,0,1,115,82,71,66,0,174,206,28,233,0,0,0,194,73,68,65,84,104,67,237,151,65,10,128,48,12,4,155,255,63,58,34,133,80,90,3,77,78,11,142,167,26,72,221,238,14,81,109,112,225,64,226,128,225,12,14,100,14,0,7,108,164,14,0,7,112,0,7,12,212,29,96,114,212,61,251,77,7,112,252,38,234,250,65,63,224,112,247,117,31,51,91,43,102,111,139,187,207,69,172,207,174,186,24,58,180,28,72,39,199,25,255,134,194,9,71,84,180,142,136,154,174,3,183,112,196,254,55,147,3,74,186,113,104,245,221,194,49,95,46,219,180,200,102,137,214,17,81,211,117,160,0,199,252,188,24,99,196,240,152,15,221,110,215,98,87,21,125,18,14,240,183,34,17,131,166,8,224,208,204,69,66,21,112,72,196,160,41,2,56,52,115,145,80,5,28,18,49,104,138,0,14,205,92,36,84,61,80,8,81,19,67,78,168,200,0,0,0,0,73,69,78,68,174,66,96,130]) },
      ];

      for (const test of tests) {
        const pre = document.createElement('pre');
        pre.innerText = test.code;
        document.body.appendChild(pre);

        const canvas = document.createElement('canvas');
        const width = 30;
        canvas.height = 1 * 6 * test.lines;
        canvas.width = 1 * 6 * width;
        document.body.appendChild(canvas);

        const context = canvas.getContext('webgpu');
        if (!context) document.body.textContent = 'Unable to get webgpu canvas context';

        context.configure({ device, format });

        const wgsl = String.raw;
        const pipeline = await device.createRenderPipelineAsync({
          layout: 'auto',
          vertex: {
            module: device.createShaderModule({
              code: wgsl`
                struct Output {
                  @builtin(position) position: vec4<f32>,
                  @location(0) uv: vec2<f32>,
                }

                @vertex
                fn main(@builtin(vertex_index) i: u32) -> Output {
                  let uv = array(vec2f(0,  1), vec2f(4, 1), vec2f(0, 0), vec2f(4, 0));
                  return Output(vec4f(uv[i] * 2 - 1, 0, 1), uv[i]);
                }`,
            }),
          },
          fragment: {
            targets: [{ format }],
            module: device.createShaderModule({
              code: wgsl`
                ${await (await fetch('visual_debugger.wgsl')).text()}

                // required to generate NAN or INF
                fn u32tof32(in: u32) -> f32 {
                  return bitcast<f32>(in);
                }

                @fragment
                fn main(
                  @location(0) unscaledUv: vec2<f32>
                ) -> @location(0) vec4<f32> {
                  let uv = unscaledUv * vec2f(${width}, ${test.lines});
                  return vec4<f32>(${test.code});
                }
              `,
            }),
          },
          primitive: { topology: 'triangle-strip' },
        });

        const commandEncoder = device.createCommandEncoder();
        const pass = commandEncoder.beginRenderPass({
          colorAttachments: [{ view: context.getCurrentTexture().createView(), loadOp: 'clear', storeOp: 'store' }],
        });
        pass.setPipeline(pipeline);
        pass.draw(4, 1);
        pass.end();
        device.queue.submit([commandEncoder.finish()]);

        canvas.toBlob(async blob => {
          const buffer = await blob.arrayBuffer();
          const bytes = new Uint8Array(buffer);

          const equal = (() => {
            if (!test.expected) {
              return false;
            }

            if (bytes.length !== test.expected.length) {
              return false;
            }

            for (let i = 0; i < test.expected.length; i++) {
              if (bytes[i] !== test.expected[i]) {
                return false;
              }
            }

            return true;
          })();

          if (!equal) {
            console.error(`Test case failed: ${test.code}`);
            console.debug(
              `        { code: '${test.code}', lines: ${test.lines}, expected: Uint8Array.from([${bytes}]) },`,
            );
          }

          pre.innerText += equal ? '✅' : '❌';
        });
      }
    </script>
    <style>
      body {
        background: #000;
        color: #fff;
        display: flex;
        flex-wrap: wrap;
        align-items: baseline;
      }
      pre {
        margin: 0px;
        text-align: right;
        flex-basis: 50%;
      }
    </style>
  </body>
</html>
